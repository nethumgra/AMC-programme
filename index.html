<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#ffffff">
    <title>AMC BRIDGE</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@500;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #7c3aed;
            --primary-hover: #6d28d9;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-light: #6b7280;
            --border-color: #e5e7eb;
            --bottom-nav-height: 80px; /* Increased height for better look */
            --header-height: 65px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            overscroll-behavior-y: none;
        }

        /* --- Scrollbar Styling --- */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }

        /* --- Auth Styles (Responsive) --- */
        .auth-wrapper { 
            display: flex; width: 100%; height: 100vh; 
            align-items: center; justify-content: center; 
            background: #f9fafb; 
            overflow-y: auto;
        }
        
        .auth-card { 
            display: flex; width: 900px; height: 600px; 
            background: white; border-radius: 24px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.05); 
            overflow: hidden; 
        }
        
        .auth-left { 
            flex: 1; 
            background: linear-gradient(135deg, #7c3aed, #4c1d95); 
            color: white; padding: 60px; 
            display: flex; flex-direction: column; justify-content: center; 
            position: relative; 
        }
        .auth-left::after { content: ''; position: absolute; bottom: -50px; right: -50px; width: 200px; height: 200px; background: rgba(255,255,255,0.1); border-radius: 50%; }
        .auth-left h1 { font-family: 'Outfit', sans-serif; font-size: 2.5rem; font-weight: 800; margin-bottom: 15px; letter-spacing: 1px; }
        .auth-left p { font-size: 1rem; opacity: 0.9; line-height: 1.6; }
        
        .auth-right { 
            flex: 1; padding: 60px; 
            display: flex; flex-direction: column; justify-content: center; 
            overflow-y: auto;
        }
        .auth-right h2 { color: var(--text-main); font-size: 1.8rem; font-weight: 700; margin-bottom: 30px; font-family: 'Outfit', sans-serif; }

        .input-group { margin-bottom: 20px; position: relative; }
        .input-group label { display: block; font-size: 0.9rem; color: var(--text-main); margin-bottom: 8px; font-weight: 500; }
        .input-group input { width: 100%; padding: 16px; border: 1px solid var(--border-color); border-radius: 12px; font-size: 1rem; transition: 0.3s; outline: none; background: #f9fafb; }
        .input-group input:focus { border-color: var(--primary-color); background: white; box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.1); }
        .password-toggle { position: absolute; right: 16px; top: 46px; color: var(--text-light); cursor: pointer; padding: 5px; font-size: 1.1rem; }

        .auth-btn { width: 100%; padding: 16px; background-color: var(--primary-color); color: white; border: none; border-radius: 12px; font-size: 1.05rem; font-weight: 600; cursor: pointer; margin-top: 10px; transition: 0.2s; box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3); }
        .auth-btn:active { transform: scale(0.98); }
        
        .switch-text { margin-top: 25px; text-align: center; font-size: 0.95rem; color: var(--text-light); }
        .switch-text a { color: var(--primary-color); text-decoration: none; font-weight: 600; }

        /* --- Dashboard Styles --- */
        .app-container { display: flex; height: 100vh; width: 100%; position: relative; overflow: hidden; }
        
        /* Desktop Sidebar */
        .sidebar-nav { 
            width: 260px; background: white; border-right: 1px solid var(--border-color); 
            padding: 20px; display: flex; flex-direction: column; gap: 10px; flex-shrink: 0; 
        }
        .brand { font-family: 'Outfit', sans-serif; font-size: 1.5rem; font-weight: 800; color: var(--primary-color); display: flex; align-items: center; gap: 10px; margin-bottom: 30px; padding-left: 10px; letter-spacing: -0.5px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 12px; color: var(--text-light); text-decoration: none; font-weight: 500; transition: 0.2s; }
        .nav-item:hover { background: #f5f3ff; color: var(--primary-color); }
        .nav-item.active { background: #f5f3ff; color: var(--primary-color); font-weight: 600; }
        
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; background: #fff; }
        
        /* Desktop Header */
        .top-header { height: 70px; background: white; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; flex-shrink: 0; }
        .breadcrumbs { font-size: 0.9rem; color: var(--text-light); }
        .user-actions { display: flex; gap: 15px; align-items: center; }
        .btn-outline { padding: 8px 16px; border: 1px solid var(--border-color); background: white; border-radius: 8px; cursor: pointer; font-weight: 500; color: var(--text-main); text-decoration: none; display: inline-block; }
        .btn-logout { background: #fee2e2; color: #991b1b; border: none; }

        /* --- Mobile Header (Professional Look) --- */
        .mobile-header {
            display: none;
            height: var(--header-height);
            background: white;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 50;
            padding-top: env(safe-area-inset-top);
            height: calc(var(--header-height) + env(safe-area-inset-top));
            box-shadow: 0 4px 20px rgba(0,0,0,0.02);
        }
        .mobile-brand { 
            font-family: 'Outfit', sans-serif; /* NEW PROFESSIONAL FONT */
            font-weight: 800; 
            color: var(--primary-color); 
            font-size: 1.3rem;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .mobile-brand i { font-size: 1.5rem; }
        .mobile-user { width: 38px; height: 38px; background: #f3f4f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--text-main); font-size: 1.1rem; }

        .course-layout { flex: 1; display: flex; padding: 30px; gap: 30px; overflow: hidden; }
        .video-column { flex: 3; display: flex; flex-direction: column; overflow-y: auto; padding-right: 10px; }
        .playlist-column { flex: 1.2; display: flex; flex-direction: column; background: white; border-radius: 20px; border: 1px solid var(--border-color); overflow: hidden; min-width: 300px; height: 100%; }

        /* --- Video Player --- */
        .video-card { width: 100%; background: black; border-radius: 20px; overflow: hidden; position: relative; aspect-ratio: 16/9; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 25px; flex-shrink: 0; }
        #player { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .click-blocker { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: transparent; z-index: 5; }
        
        .custom-controls { position: absolute; bottom: 0; left: 0; width: 100%; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); padding: 20px 20px 15px 20px; display: flex; align-items: center; gap: 15px; z-index: 20; }
        .control-btn { background: none; border: none; color: white; cursor: pointer; font-size: 1.2rem; padding: 5px; }
        .time-display { color: white; font-size: 0.85rem; font-family: monospace; min-width: 90px; text-align: center; }
        .seek-bar { flex: 1; cursor: pointer; -webkit-appearance: none; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; }
        .seek-bar::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: white; border-radius: 50%; }
        .speed-select { background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 6px; padding: 4px 8px; font-size: 0.8rem; cursor: pointer; outline: none; }

        /* --- Watermark Styles --- */
        @keyframes pan-grid { 0% { transform: translate(0, 0); } 50% { transform: translate(-40px, -20px); } 100% { transform: translate(0, 0); } }
        .full-coverage-watermark { position: absolute; top: -10%; left: -10%; width: 120%; height: 120%; z-index: 3; pointer-events: none; display: flex; flex-wrap: wrap; align-items: flex-start; justify-content: center; overflow: hidden; animation: pan-grid 25s linear infinite; }
        .watermark-item { color: rgba(255, 255, 255, 0.3); font-size: 16px; font-weight: 400; padding: 50px; transform: rotate(-30deg); white-space: nowrap; text-shadow: none; }

        @keyframes scroll-left { 0% { transform: translateX(100vw); } 100% { transform: translateX(-100%); } }
        .disclaimer-watermark { position: absolute; z-index: 4; color: rgba(255, 255, 255, 0.5); font-size: 18px; font-weight: 600; pointer-events: none; white-space: nowrap; animation: scroll-left 25s linear infinite; }
        #top-disclaimer { top: 20px; }
        #bottom-disclaimer { bottom: 60px; animation-delay: -12s; }

        .course-info h1 { font-family: 'Outfit', sans-serif; font-size: 1.8rem; font-weight: 800; margin-bottom: 10px; color: var(--text-main); }
        .course-meta { display: flex; gap: 20px; color: var(--text-light); font-size: 0.9rem; margin-bottom: 20px; }
        .course-meta i { color: var(--primary-color); margin-right: 5px; }
        
        .playlist-header { padding: 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; background: white; position: sticky; top: 0; z-index: 10; }
        .playlist-header h3 { font-size: 1.1rem; font-weight: 700; }
        #videoPlaylist { list-style: none; overflow-y: auto; flex: 1; }
        #videoPlaylist li { padding: 16px 20px; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: 0.2s; display: flex; align-items: flex-start; gap: 15px; background: white; }
        #videoPlaylist li:hover { background: #f9fafb; }
        #videoPlaylist li.active { background: #f5f3ff; }
        #videoPlaylist li.active .play-icon-wrapper { background: var(--primary-color); color: white; }
        #videoPlaylist li.active .video-details strong { color: var(--primary-color); }

        .play-icon-wrapper { width: 32px; height: 32px; background: #f3f4f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #9ca3af; flex-shrink: 0; margin-top: 2px; transition: 0.2s; }
        .video-details { flex: 1; }
        .video-details strong { display: block; font-size: 0.95rem; margin-bottom: 4px; color: var(--text-main); line-height: 1.3; }
        .video-details span { font-size: 0.8rem; color: var(--text-light); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* --- Mobile Bottom Nav (Professional App Style) --- */
        .bottom-nav {
            display: none;
            position: fixed; bottom: 0; left: 0; width: 100%;
            height: calc(var(--bottom-nav-height) + env(safe-area-inset-bottom));
            padding-bottom: env(safe-area-inset-bottom);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-top: 1px solid rgba(0,0,0,0.08);
            z-index: 1000;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -5px 25px rgba(0,0,0,0.05);
            border-radius: 20px 20px 0 0; /* App-like rounded top */
        }
        .bottom-nav-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #9ca3af; text-decoration: none; font-size: 0.75rem; font-weight: 600;
            width: 100%; height: 100%; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        .bottom-nav-item i { 
            font-size: 1.5rem; 
            margin-bottom: 6px; 
            transition: 0.3s;
            padding: 8px;
            border-radius: 12px;
        }
        /* Active State Animation */
        .bottom-nav-item.active { color: var(--primary-color); }
        .bottom-nav-item.active i { 
            background: rgba(124, 58, 237, 0.1); 
            transform: translateY(-5px);
        }
        .bottom-nav-item:active i { transform: scale(0.9); }

        .toast-message { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #1f2937; color: white; padding: 12px 24px; border-radius: 50px; opacity: 0; transition: 0.3s; pointer-events: none; z-index: 1000; font-size: 0.9rem; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .toast-message.show { opacity: 1; }

        /* --- SECURITY & OVERLAYS --- */
        .security-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000000; z-index: 9999; display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white; }
        .security-overlay.active { display: flex; }
        .security-icon { font-size: 4rem; color: #ef4444; margin-bottom: 20px; }
        .security-title { font-size: 2rem; font-weight: 800; margin-bottom: 10px; color: #ef4444; text-transform: uppercase; }
        .security-msg { font-size: 1.1rem; color: #d1d5db; margin-bottom: 30px; max-width: 500px; line-height: 1.5; padding: 0 20px; }
        .verify-btn { padding: 15px 40px; background: var(--primary-color); color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
        .loader-circle { border: 4px solid rgba(255,255,255,0.3); border-left-color: var(--primary-color); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- MOBILE APP TRANSFORMATION --- */
        @media (max-width: 1024px) {
            /* Layout & Auth */
            .auth-card { width: 100%; height: 100%; border-radius: 0; flex-direction: column; box-shadow: none; }
            .auth-left { display: none; } 
            .auth-right { padding: 30px; padding-top: 60px; justify-content: flex-start; background: white; }
            .auth-right h2 { font-size: 2rem; margin-top: 20px; }
            
            /* Main Content Structure */
            .app-container { flex-direction: column; height: 100vh; }
            .sidebar-nav { display: none; }
            .top-header { display: none; }
            .mobile-header { display: flex; }
            .bottom-nav { display: flex; }
            
            /* Scrolling Content Area */
            .course-layout { 
                flex-direction: column; 
                padding: 0; 
                gap: 0; 
                overflow-y: auto; 
                flex: 1; 
                padding-bottom: calc(var(--bottom-nav-height) + 20px); /* Clear bottom nav */
                -webkit-overflow-scrolling: touch;
            }

            /* Video Section (Sticky on Scroll) */
            .video-column { 
                flex: none; 
                padding: 0; 
                overflow: visible; 
                position: sticky; 
                top: 0; 
                z-index: 10; 
                background: black;
            }
            .course-info { padding: 15px 20px 0 20px; background: white; }
            .course-info h1 { font-size: 1.3rem; margin-top: 5px; line-height: 1.3; }
            .course-meta { margin-bottom: 10px; font-size: 0.8rem; padding-left: 20px; }
            
            /* Video Player Adjust */
            .video-card { border-radius: 0; margin-bottom: 0; box-shadow: none; }
            
            /* Playlist Section */
            .playlist-column { 
                flex: 1; 
                border-radius: 0; 
                border: none; 
                height: auto; 
                background: white; 
                padding-top: 10px;
            }
            .playlist-header { padding: 15px 20px; background: #f9fafb; border-bottom: 1px solid var(--border-color); border-top: 1px solid var(--border-color); }
            #videoPlaylist { overflow-y: visible; }
            
            /* Custom Controls */
            .custom-controls { padding: 10px 15px; }
            .time-display { font-size: 0.75rem; min-width: 80px; }
            .control-btn { font-size: 1.4rem; padding: 8px; }
        }
    </style>
</head>
<body>

    <div id="securityOverlay" class="security-overlay">
        <div id="warningContent" style="display: flex; flex-direction: column; align-items: center;">
            <i class="fas fa-exclamation-triangle security-icon"></i>
            <div class="security-title">Security Alert</div>
            <p class="security-msg">Screen recording and switching tabs are restricted.</p>
            <button id="verifyBtn" class="verify-btn">
                <i class="fas fa-user-shield"></i> Resume
            </button>
        </div>
        <div id="loadingContent" style="display: none; flex-direction: column; align-items: center;">
            <div class="loader-circle"></div>
            <p style="font-size: 1.1rem; color: #ccc;">Verifying...</p>
        </div>
        <div id="successContent" style="display: none; flex-direction: column; align-items: center;">
            <i class="fas fa-check-circle success-icon" style="display: block; color: #22c55e; font-size: 4rem; animation: popIn 0.5s ease;"></i>
            <div class="security-title" style="color: #22c55e;">Verified!</div>
        </div>
    </div>

    <div id="regOverlay" class="security-overlay">
        <div id="regLoading" style="display: flex; flex-direction: column; align-items: center;">
            <div class="loader-circle"></div>
            <p style="font-size: 1.1rem; color: #ccc;">Creating Account...</p>
        </div>
        <div id="regSuccess" style="display: none; flex-direction: column; align-items: center;">
             <i class="fas fa-check-circle success-icon" style="display:block; color:#22c55e; font-size:4rem;"></i>
             <h3 style="color:#22c55e; margin-top:10px;">Registered!</h3>
        </div>
        <div id="regReview" style="display: none; flex-direction: column; align-items: center; text-align: center; max-width: 500px;">
             <i class="fas fa-user-clock" style="font-size:4rem; color:#f59e0b; margin-bottom:20px;"></i>
             <h3 style="color:white; margin-bottom:10px; font-size:1.5rem;">Approval Pending</h3>
             <p style="color:#d1d5db; margin-bottom:30px; font-size:1rem; line-height:1.5; padding:0 20px;">
                Your account is waiting for admin approval. You will be able to login once approved.
             </p>
             <button id="regOkBtn" class="verify-btn">Got it</button>
        </div>
    </div>

    <div id="mainContainer">
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; color: #7c3aed; background: white;">
            <i class="fas fa-circle-notch fa-spin" style="font-size: 2.5rem;"></i>
        </div>
    </div>

    <template id="loginTemplate">
        <div class="auth-wrapper">
            <div class="auth-card">
                <div class="auth-left">
                    <h1>AMC BRIDGE</h1>
                    <p>Welcome to the AMC Bridge learning platform.</p>
                </div>
                <div class="auth-right">
                    <div style="margin-bottom: 30px;">
                        <i class="fas fa-graduation-cap" style="font-size: 3rem; color: var(--primary-color);"></i>
                    </div>
                    <h2>Welcome Back</h2>
                    <p style="color: #6b7280; margin-bottom: 30px;">Sign in to continue learning</p>
                    <form id="loginForm">
                        <div class="input-group"><label>Email Address</label><input type="email" id="loginEmail" required placeholder="Enter your email"></div>
                        <div class="input-group"><label>Password</label><input type="password" id="loginPassword" required placeholder="Enter your password"><i class="fas fa-eye password-toggle"></i></div>
                        <div style="text-align: right; margin-bottom: 20px;">
                             <a href="#" id="forgotPasswordLink" style="color:var(--primary-color); font-size:0.9rem; text-decoration:none; font-weight: 500;">Forgot Password?</a>
                        </div>
                        <button type="submit" class="auth-btn">Sign In</button>
                    </form>
                    <p class="message" id="loginMessage" style="text-align:center; margin-top:15px; color:red; font-size:0.9rem;"></p>
                    <div class="switch-text">Don't have an account? <a href="#" class="showRegisterLink">Create Account</a></div>
                </div>
            </div>
        </div>
    </template>

    <template id="registerTemplate">
        <div class="auth-wrapper">
            <div class="auth-card">
                <div class="auth-left">
                    <h1>Join Us</h1>
                </div>
                <div class="auth-right">
                    <h2>Create Account</h2>
                    <p style="color: #6b7280; margin-bottom: 20px;">Join the community today</p>
                    <form id="registerForm">
                        <div class="input-group"><label>Username</label><input type="text" id="registerUsername" required placeholder="John Doe"></div>
                        <div class="input-group"><label>Email</label><input type="email" id="registerEmail" required placeholder="john@example.com"></div>
                        <div class="input-group"><label>Mobile</label><input type="tel" id="registerMobile" required placeholder="07XXXXXXXX"></div>
                        <div class="input-group"><label>Password</label><input type="password" id="registerPassword" required placeholder="Create password"><i class="fas fa-eye password-toggle"></i></div>
                        <button type="submit" class="auth-btn">Register</button>
                    </form>
                    <p class="message" id="registerMessage" style="text-align:center; margin-top:15px; font-size:0.9rem;"></p>
                    <div class="switch-text">Already have an account? <a href="#" class="showLoginLink">Sign In</a></div>
                </div>
            </div>
        </div>
    </template>

    <template id="videoTemplate">
        <div class="app-container">
            <div class="mobile-header">
                <div class="mobile-brand">
                    <i class="fas fa-graduation-cap"></i> AMC BRIDGE
                </div>
                <div class="mobile-user"><i class="fas fa-user"></i></div>
            </div>

            <aside class="sidebar-nav">
                <div class="brand"><i class="fas fa-graduation-cap"></i> AMC BRIDGE</div>
                <a href="#" class="nav-item"><i class="fas fa-home"></i> Dashboard</a>
                <a href="pdfs.html" class="nav-item"><i class="fas fa-book"></i> Materials</a>
                <a href="#" class="nav-item active"><i class="fas fa-play-circle"></i> Courses</a>
            </aside>

            <main class="main-content">
                <header class="top-header">
                    <div class="breadcrumbs">Courses / AMC Programme / <span>Course Content</span></div>
                    <div class="user-actions">
                        <a href="pdfs.html" class="btn-outline">Materials</a>
                        <button class="btn-outline btn-logout">Logout</button>
                    </div>
                </header>

                <div class="course-layout">
                    <div class="video-column">
                        <div class="video-card">
                            <div id="player"></div>
                            <div class="click-blocker"></div>
                            <div id="video-watermark" class="full-coverage-watermark"></div>
                            <div id="top-disclaimer" class="disclaimer-watermark">Protected Content - Do Not Copy</div>
                            
                            <div class="custom-controls">
                                <button id="custom-play-btn" class="control-btn"><i class="fas fa-play"></i></button>
                                <span id="time-display" class="time-display">00:00 / 00:00</span>
                                <input type="range" id="seek-bar" class="seek-bar" value="0" min="0" max="100" step="0.1">
                                <select id="speed-select" class="speed-select">
                                    <option value="1" selected>1x</option>
                                    <option value="1.5">1.5x</option>
                                    <option value="2">2x</option>
                                </select>
                                <button id="custom-fs-btn" class="control-btn"><i class="fas fa-expand"></i></button>
                            </div>
                        </div>
                        
                        <div class="course-info">
                            <h1><span id="current-video-title">Loading...</span></h1>
                            <div class="course-meta">
                                <span><i class="fas fa-video"></i> Video Lessons</span>
                            </div>
                        </div>
                    </div>

                    <div class="playlist-column">
                        <div class="playlist-header">
                            <h3>Course Syllabus</h3>
                        </div>
                        <ul id="videoPlaylist"></ul>
                    </div>
                </div>

                <nav class="bottom-nav">
                    <a href="#" onclick="window.location.reload(); return false;" class="bottom-nav-item">
                        <i class="fas fa-house"></i>
                        <span>Home</span>
                    </a>
                    <a href="#" class="bottom-nav-item active">
                        <i class="fas fa-layer-group"></i>
                        <span>Courses</span>
                    </a>
                    <a href="pdfs.html" class="bottom-nav-item">
                        <i class="fas fa-file-pdf"></i>
                        <span>Notes</span>
                    </a>
                    <a href="#" class="bottom-nav-item btn-logout" style="color:#ef4444;">
                        <i class="fas fa-arrow-right-from-bracket"></i>
                        <span>Exit</span>
                    </a>
                </nav>
            </main>
            <div id="keyboard-disabled-toast" class="toast-message">Controls Disabled</div>
        </div>
    </template>

    <template id="popupTemplate">
        <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 9999; display: flex; justify-content: center; align-items: center; padding: 20px;">
            <div style="background: white; padding: 30px; border-radius: 20px; text-align: center; max-width: 400px; width: 100%; box-shadow: 0 10px 25px rgba(0,0,0,0.1);">
                <h2 id="popupTitle" style="margin-bottom: 10px; font-size:1.3rem;"></h2>
                <p id="popupMessage" style="margin-bottom: 25px; color: #666; font-size:1rem;"></p>
                <button id="popupCloseBtn" style="background: var(--primary-color); color: white; border: none; padding: 12px 30px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 1rem; width: 100%;">OK</button>
            </div>
        </div>
    </template>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, query, orderBy, onSnapshot, doc, getDoc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signOut, createUserWithEmailAndPassword, sendEmailVerification, signInWithEmailAndPassword, setPersistence, browserLocalPersistence, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyASA8KptfOy9pezf3QCoWHt9Bg28yN3HsM",
            authDomain: "amce-5d785.firebaseapp.com",
            projectId: "amce-5d785",
            storageBucket: "amce-5d785.appspot.com",
            messagingSenderId: "877483628426",
            appId: "1:877483628426:web:dfd8961b06c35e6cc95a73"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        const mainContainer = document.getElementById('mainContainer');
        const securityOverlay = document.getElementById('securityOverlay');
        const verifyBtn = document.getElementById('verifyBtn');
        const regOverlay = document.getElementById('regOverlay');
        const regOkBtn = document.getElementById('regOkBtn');

        let currentPlaylist = [];
        let player = null;
        let updateTimer;
        let isDragging = false;
        let isLocked = false;
        let isRegistrationProcess = false;
        
        const INACTIVITY_TIMEOUT = 5 * 60 * 1000;
        const WARNING_DURATION = 60 * 1000;
        let activityTimer;
        let warningCountdownTimer;

        function extractVideoId(url) {
            if (!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : url;
        }

        function formatTime(time) {
            if (!time) return "00:00";
            time = Math.round(time);
            let minutes = Math.floor(time / 60);
            let seconds = time - minutes * 60;
            seconds = seconds < 10 ? '0' + seconds : seconds;
            return minutes + ":" + seconds;
        }

        function lockScreen() {
            if(isLocked || !auth.currentUser) return;
            isLocked = true;
            if(player && typeof player.pauseVideo === 'function') player.pauseVideo();
            
            document.getElementById('warningContent').style.display = 'flex';
            document.getElementById('loadingContent').style.display = 'none';
            document.getElementById('successContent').style.display = 'none';
            securityOverlay.classList.add('active');
        }

        verifyBtn.addEventListener('click', () => {
            document.getElementById('warningContent').style.display = 'none';
            document.getElementById('loadingContent').style.display = 'flex';

            setTimeout(() => {
                document.getElementById('loadingContent').style.display = 'none';
                document.getElementById('successContent').style.display = 'flex';

                setTimeout(() => {
                    securityOverlay.classList.remove('active');
                    isLocked = false;
                    if(player && typeof player.playVideo === 'function') player.playVideo();
                }, 1500);
            }, 2000);
        });

        const handleVisibilityChange = () => {
            if (document.hidden && mainContainer.classList.contains('video-view-container')) {
                lockScreen();
            }
        };

        const handleMouseLeave = () => {
             if (mainContainer.classList.contains('video-view-container') && window.innerWidth > 1024) {
                lockScreen();
            }
        };

        function showPopup(title, message, onOk) {
            const template = document.getElementById('popupTemplate').content.cloneNode(true);
            const popup = template.firstElementChild;
            popup.querySelector('#popupTitle').textContent = title;
            popup.querySelector('#popupMessage').textContent = message;
            popup.querySelector('#popupCloseBtn').addEventListener('click', () => {
                popup.remove();
                if (onOk) onOk();
            });
            document.body.appendChild(popup);
        }

        function handleLogout() {
            const existingPopup = document.getElementById('inactivity-popup');
            if (existingPopup) existingPopup.remove();
            clearTimeout(activityTimer);
            clearTimeout(warningCountdownTimer);

            document.removeEventListener('visibilitychange', handleVisibilityChange);
            document.documentElement.removeEventListener('mouseleave', handleMouseLeave);
            player = null;
            signOut(auth).catch(error => console.error(error));
        }

        function showInactivityWarning() {
            if (player && typeof player.pauseVideo === 'function') {
                player.pauseVideo();
            }

            const existingPopup = document.getElementById('inactivity-popup');
            if (existingPopup) existingPopup.remove();

            const popupHTML = `
                <div id="inactivity-popup" style="
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0,0,0,0.85); z-index: 10000;
                    display: flex; flex-direction: column; align-items: center; justify-content: center;
                    color: white; font-family: 'Inter', sans-serif; animation: fadeIn 0.3s;">
                    
                    <div style="background: #1f2937; padding: 40px; border-radius: 20px; text-align: center; border: 1px solid #374151; max-width: 400px; width:90%;">
                        <i class="fas fa-bed" style="font-size: 4rem; color: #f59e0b; margin-bottom: 20px;"></i>
                        <h2 style="margin-bottom: 10px; font-size: 1.5rem;">Still watching?</h2>
                        <p style="color: #9ca3af; margin-bottom: 30px;">Paused due to inactivity.</p>
                        
                        <button id="resume-btn" style="
                            background: #7c3aed; color: white; border: none; padding: 12px 30px;
                            font-size: 1rem; font-weight: 600; border-radius: 10px; cursor: pointer; width: 100%;">
                            I'm Here
                        </button>
                        
                        <p style="margin-top: 20px; font-size: 0.8rem; color: #ef4444;">
                            Logging out in <span id="auto-logout-timer">60</span>s
                        </p>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', popupHTML);

            let secondsLeft = 60;
            const timerSpan = document.getElementById('auto-logout-timer');
            
            const countdownInterval = setInterval(() => {
                secondsLeft--;
                if(timerSpan) timerSpan.innerText = secondsLeft;
                if(secondsLeft <= 0) clearInterval(countdownInterval);
            }, 1000);

            warningCountdownTimer = setTimeout(() => {
                clearInterval(countdownInterval);
                document.getElementById('inactivity-popup')?.remove();
                handleLogout();
            }, WARNING_DURATION);

            document.getElementById('resume-btn').addEventListener('click', () => {
                clearTimeout(warningCountdownTimer);
                clearInterval(countdownInterval);
                document.getElementById('inactivity-popup').remove();
                
                if (player && typeof player.playVideo === 'function') {
                    player.playVideo();
                }
                
                if (auth.currentUser && mainContainer.classList.contains('video-view-container')) {
                    activityTimer = setTimeout(showInactivityWarning, INACTIVITY_TIMEOUT);
                }
            });
        }

        function resetActivityTimer() {
            if (document.getElementById('inactivity-popup')) return;

            clearTimeout(activityTimer);
            clearTimeout(warningCountdownTimer);
            
            if (auth.currentUser && mainContainer.classList.contains('video-view-container')) {
                activityTimer = setTimeout(showInactivityWarning, INACTIVITY_TIMEOUT);
            }
        }

        function setupActivityListeners() {
            ['mousemove', 'keydown', 'click', 'scroll', 'touchstart'].forEach(evt => document.addEventListener(evt, resetActivityTimer));
            resetActivityTimer();
            document.addEventListener('visibilitychange', handleVisibilityChange);
            document.documentElement.addEventListener('mouseleave', handleMouseLeave);
        }

        function removeActivityListeners() {
            clearTimeout(activityTimer);
            ['mousemove', 'keydown', 'click', 'scroll', 'touchstart'].forEach(evt => document.removeEventListener(evt, resetActivityTimer));
            document.removeEventListener('visibilitychange', handleVisibilityChange);
            document.documentElement.removeEventListener('mouseleave', handleMouseLeave);
        }

        onAuthStateChanged(auth, async (user) => {
            if (isRegistrationProcess) return;

            if (user) {
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists() && userDoc.data().isApproved === true) {
                    if (!mainContainer.classList.contains('video-view-container')) {
                        showView('video');
                    }
                    setupActivityListeners();
                } else {
                    await signOut(auth);
                    showView('login');
                }
            } else {
                showView('login');
                removeActivityListeners();
                securityOverlay.classList.remove('active');
                regOverlay.classList.remove('active');
                isLocked = false;
            }
        });

        async function showView(viewName) {
            mainContainer.innerHTML = '';
            const template = document.getElementById(viewName + 'Template').content.cloneNode(true);
            if (viewName === 'video') {
                mainContainer.className = 'main-container video-view-container';
                mainContainer.appendChild(template);
                if (player) { player.destroy(); player = null; }
                if (typeof YT !== 'undefined' && YT.Player) { initPlayer(); }
                
                listenToVideos();
                
                populateWatermark('#video-watermark');
                resetActivityTimer();
                attachEventListeners(viewName);
            } else {
                mainContainer.className = 'main-container';
                mainContainer.appendChild(template);
                player = null;
                removeActivityListeners();
                attachEventListeners(viewName);
            }
        }

        function attachEventListeners(viewName) {
            if (viewName === 'login' || viewName === 'register') {
                const passwordToggles = mainContainer.querySelectorAll('.password-toggle');
                passwordToggles.forEach(toggle => {
                    toggle.addEventListener('click', () => {
                        const passwordInput = toggle.previousElementSibling;
                        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                        passwordInput.setAttribute('type', type);
                        toggle.classList.toggle('fa-eye');
                        toggle.classList.toggle('fa-eye-slash');
                    });
                });
            }

            if (viewName === 'login') {
                mainContainer.querySelector('.showRegisterLink').addEventListener('click', (e) => { e.preventDefault(); showView('register'); });
                mainContainer.querySelector('#loginForm').addEventListener('submit', handleLogin);
                mainContainer.querySelector('#forgotPasswordLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    const email = mainContainer.querySelector('#loginEmail').value;
                    if(!email) { alert("Enter email first"); return; }
                    sendPasswordResetEmail(auth, email).then(() => alert("Email sent!")).catch(e => alert(e.message));
                });
            } else if (viewName === 'register') {
                mainContainer.querySelector('.showLoginLink').addEventListener('click', (e) => { e.preventDefault(); showView('login'); });
                mainContainer.querySelector('#registerForm').addEventListener('submit', handleRegister);
            } else if (viewName === 'video') {
                const logoutBtns = mainContainer.querySelectorAll('.btn-logout');
                logoutBtns.forEach(btn => btn.addEventListener('click', handleLogout));
                
                const playBtn = document.getElementById('custom-play-btn');
                const seekBar = document.getElementById('seek-bar');
                const speedSelect = document.getElementById('speed-select');
                const fsBtn = document.getElementById('custom-fs-btn');
                
                if (playBtn) {
                    playBtn.addEventListener('click', () => {
                        if (player && typeof player.getPlayerState === 'function') {
                            player.getPlayerState() === YT.PlayerState.PLAYING ? player.pauseVideo() : player.playVideo();
                        }
                    });
                }

                if (seekBar) {
                    seekBar.addEventListener('mousedown', () => { isDragging = true; });
                    seekBar.addEventListener('touchstart', () => { isDragging = true; });
                    seekBar.addEventListener('change', () => {
                        isDragging = false;
                        if (player && typeof player.getDuration === 'function') {
                            player.seekTo(player.getDuration() * (seekBar.value / 100), true);
                        }
                    });
                    seekBar.addEventListener('input', () => { isDragging = true; });
                }

                if (speedSelect) {
                    speedSelect.addEventListener('change', (e) => {
                        if (player && typeof player.setPlaybackRate === 'function') {
                            player.setPlaybackRate(parseFloat(e.target.value));
                        }
                    });
                }

                if (fsBtn) {
                    fsBtn.addEventListener('click', () => {
                        const wrapper = document.querySelector('.video-card');
                        if (!document.fullscreenElement) {
                            wrapper.requestFullscreen().catch(err => console.error(err));
                        } else {
                            document.exitFullscreen();
                        }
                    });
                }
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = mainContainer.querySelector('#loginEmail').value;
            const password = mainContainer.querySelector('#loginPassword').value;
            const messageEl = mainContainer.querySelector('#loginMessage');
            const submitBtn = e.submitter;
            submitBtn.disabled = true;
            try {
                await setPersistence(auth, browserLocalPersistence);
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                
                const userDoc = await getDoc(doc(db, "users", userCredential.user.uid));
                if (!userDoc.exists() || userDoc.data().isApproved !== true) {
                     await signOut(auth);
                     throw new Error("Account under review.");
                }

            } catch (error) {
                if(error.message === "Account under review.") {
                    messageEl.textContent = "Your account is awaiting admin approval.";
                } else {
                    messageEl.textContent = 'Invalid credentials.';
                }
                submitBtn.disabled = false;
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const username = mainContainer.querySelector('#registerUsername').value;
            const email = mainContainer.querySelector('#registerEmail').value;
            const mobile = mainContainer.querySelector('#registerMobile').value;
            const password = mainContainer.querySelector('#registerPassword').value;
            const messageEl = mainContainer.querySelector('#registerMessage');
            const submitBtn = e.submitter;
            submitBtn.disabled = true;

            try {
                isRegistrationProcess = true;
                regOverlay.classList.add('active');
                document.getElementById('regLoading').style.display = 'flex';
                document.getElementById('regSuccess').style.display = 'none';
                document.getElementById('regReview').style.display = 'none';

                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                await setDoc(doc(db, "users", userCredential.user.uid), { 
                    username, email, mobile, 
                    createdAt: new Date(),
                    isApproved: false, 
                    isAdmin: false 
                });
                
                await signOut(auth);
                
                setTimeout(() => {
                    document.getElementById('regLoading').style.display = 'none';
                    document.getElementById('regSuccess').style.display = 'flex';
                    setTimeout(() => {
                        document.getElementById('regSuccess').style.display = 'none';
                        document.getElementById('regReview').style.display = 'flex';
                    }, 2000);
                }, 1500);

            } catch (error) {
                isRegistrationProcess = false;
                regOverlay.classList.remove('active');
                messageEl.textContent = error.message;
                submitBtn.disabled = false;
            }
        }

        regOkBtn.addEventListener('click', async () => {
            regOverlay.classList.remove('active');
            isRegistrationProcess = false;
            await signOut(auth);
            showView('login');
        });

        async function populateWatermark(containerSelector) {
            const currentUser = auth.currentUser;
            if (!currentUser) return;
            const watermarkContainer = document.querySelector(containerSelector);
            if (!watermarkContainer) return;
            const userDocRef = doc(db, "users", currentUser.uid);
            const userDocSnap = await getDoc(userDocRef);
            if (userDocSnap.exists()) {
                const { username, mobile } = userDocSnap.data();
                const details = `${username} / ${mobile}`;
                let html = '';
                for (let i = 0; i < 200; i++) { html += `<span class="watermark-item">${details}</span>`; }
                watermarkContainer.innerHTML = html;
            }
        }

        window.onYouTubeIframeAPIReady = function() { initPlayer(); }

        function initPlayer() {
            if (document.getElementById('player') && !player) {
                player = new YT.Player('player', {
                    height: '100%',
                    width: '100%',
                    playerVars: { 'autoplay': 1, 'playsinline': 1, 'controls': 0, 'rel': 0, 'showinfo': 0, 'modestbranding': 1, 'disablekb': 1, 'fs': 0 },
                    events: { 'onReady': onPlayerReady, 'onStateChange': onPlayerStateChange, 'onError': onPlayerError }
                });
            }
        }

        function onPlayerReady(event) {
            if (currentPlaylist.length > 0) {
                const firstVideoId = extractVideoId(currentPlaylist[0].id);
                if(firstVideoId) {
                    event.target.cueVideoById(firstVideoId);
                    setTimeout(() => event.target.playVideo(), 500);
                }
            }
            clearInterval(updateTimer);
            updateTimer = setInterval(updateCustomControls, 250);
        }

        function onPlayerError(event) {
            console.error("YouTube Player Error:", event.data);
        }

        function onPlayerStateChange(event) {
            const playBtnIcon = document.querySelector('#custom-play-btn i');
            if (playBtnIcon) {
                playBtnIcon.className = event.data == YT.PlayerState.PLAYING ? 'fas fa-pause' : 'fas fa-play';
            }
        }

        function updateCustomControls() {
            if (!player || typeof player.getCurrentTime !== 'function') return;
            const currentTime = player.getCurrentTime();
            const duration = player.getDuration();
            const timeDisplay = document.getElementById('time-display');
            if (timeDisplay) timeDisplay.textContent = formatTime(currentTime) + " / " + formatTime(duration);
            const seekBar = document.getElementById('seek-bar');
            if (seekBar && duration > 0 && !isDragging) {
                seekBar.value = (currentTime / duration) * 100;
            }
        }

        function listenToVideos() {
            const videosQuery = query(collection(db, "videos"), orderBy("createdAt", "desc"));
            onSnapshot(videosQuery, (snapshot) => {
                currentPlaylist = [];
                snapshot.forEach((doc) => currentPlaylist.push(doc.data()));
                renderPlaylist(currentPlaylist);
                
                if (player && typeof player.getPlayerState === 'function' && currentPlaylist.length > 0) {
                    const state = player.getPlayerState();
                    if (state === -1 || state === 5) {
                        const firstId = extractVideoId(currentPlaylist[0].id);
                        if(firstId) {
                            player.cueVideoById(firstId);
                            setTimeout(() => player.playVideo(), 1000);
                            const titleEl = document.getElementById('current-video-title');
                            if(titleEl) titleEl.innerText = currentPlaylist[0].title;
                        }
                    }
                }
            });
        }

        function renderPlaylist(playlist) {
            const playlistElement = document.getElementById('videoPlaylist');
            if (!playlistElement) return;
            playlistElement.innerHTML = '';
            if (playlist.length === 0) { playlistElement.innerHTML = `<li style="color:#999; justify-content:center;">No videos available</li>`; return; }
            playlist.forEach((video, index) => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <div class="play-icon-wrapper"><i class="fas fa-play"></i></div>
                    <div class="video-details"><strong>${video.title}</strong><span>${video.description || 'Watch now'}</span></div>
                `;
                listItem.addEventListener('click', () => {
                    const videoId = extractVideoId(video.id);
                    if (player && player.loadVideoById && videoId) {
                        player.loadVideoById(videoId);
                        player.playVideo();
                        const titleEl = document.getElementById('current-video-title');
                        if(titleEl) titleEl.innerText = video.title;
                        document.querySelector('#videoPlaylist li.active')?.classList.remove('active');
                        listItem.classList.add('active');
                    }
                });
                if (index === 0) {
                    listItem.classList.add('active');
                    const titleEl = document.getElementById('current-video-title');
                    if(titleEl) titleEl.innerText = video.title;
                }
                playlistElement.appendChild(listItem);
            });
        }

        document.addEventListener('keydown', e => { 
            if (document.getElementById('player')) { 
                const activeElement = document.activeElement;
                if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA')) { return; }
                e.preventDefault(); 
                const toast = document.getElementById('keyboard-disabled-toast');
                if (toast) { toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 1500); }
            }
        });
        document.addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>